<phone:PhoneApplicationPage xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" xmlns:phone="clr-namespace:Microsoft.Phone.Controls;assembly=Microsoft.Phone" xmlns:controls="clr-namespace:Microsoft.Phone.Controls;assembly=Microsoft.Phone.Controls" xmlns:shell="clr-namespace:Microsoft.Phone.Shell;assembly=Microsoft.Phone" xmlns:d="http://schemas.microsoft.com/expression/blend/2008" xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" xmlns:customControls="clr-namespace:Tweeta.CustomControl" xmlns:toolkit="clr-namespace:Microsoft.Phone.Controls;assembly=Microsoft.Phone.Controls.Toolkit" xmlns:Tweeta_ViewModel="clr-namespace:Tweeta.ViewModel" xmlns:i="clr-namespace:System.Windows.Interactivity;assembly=System.Windows.Interactivity" xmlns:ec="clr-namespace:Microsoft.Expression.Interactivity.Core;assembly=Microsoft.Expression.Interactions" xmlns:Tweeta_Common="clr-namespace:Tweeta.Common" xmlns:Tweeta_Behaviors="clr-namespace:Tweeta.Behaviors" xmlns:controlsPrimitives="clr-namespace:Microsoft.Phone.Controls.Primitives;assembly=Microsoft.Phone.Controls" 
                            xmlns:Tweeta_ViewModel_Pages="clr-namespace:Tweeta.ViewModel.Pages" xmlns:Tweeta="clr-namespace:Tweeta"
                            d:DesignWidth="480"
                            mc:Ignorable="d"
                            d:DesignHeight="728"
                            x:Class="Tweeta.Views.MainPanoramaPage"
                            SupportedOrientations="Portrait"
                            Orientation="Portrait"
                            shell:SystemTray.IsVisible="False"
                            Tweeta_Common:TiltEffect.IsTiltEnabled="True"
                            >


    <phone:PhoneApplicationPage.Resources>
	
    	
		<shell:ApplicationBar IsVisible="True" IsMenuEnabled="True" Opacity="1.0" 
			x:Key="appBarFull">
        
			<shell:ApplicationBar.MenuItems>
				<shell:ApplicationBarMenuItem Text="settings"  />
            
			</shell:ApplicationBar.MenuItems>

            <shell:ApplicationBarIconButton IconUri="/Images/appbar.add.rest.png" Text="new tweet" Click="NewTweetClicked" />
            <shell:ApplicationBarIconButton IconUri="/icons/appbar.feature.search.rest.png" Text="search" Click="SearchClicked" />

		</shell:ApplicationBar>


		<Style x:Key="PanoramaLoadingStyle"
			TargetType="customControls:LoadingPanoramaItem">
			<Setter Property="CacheMode" Value="BitmapCache"/>
			<Setter Property="HorizontalContentAlignment" Value="Stretch"/>
			<Setter Property="VerticalContentAlignment" Value="Stretch"/>
			<Setter Property="Template">
				<Setter.Value>
					<ControlTemplate TargetType="controls:PanoramaItem">
						<ScrollViewer>
							<Grid Background="{TemplateBinding Background}" Margin="12,0,0,0">
								<Grid.RowDefinitions>
									<RowDefinition Height="auto"/>
									<RowDefinition Height="*"/>
								</Grid.RowDefinitions>
								<ContentControl x:Name="header" ContentTemplate="{TemplateBinding HeaderTemplate}" Content="{TemplateBinding Header}" FontSize="{StaticResource PhoneFontSizeExtraExtraLarge}" FontFamily="{StaticResource PhoneFontFamilySemiLight}" HorizontalAlignment="Left" Margin="10,-2,0,26">
									<ContentControl.RenderTransform>
										<TranslateTransform x:Name="headerTransform"/>
									</ContentControl.RenderTransform>
								</ContentControl>
								<StackPanel Grid.Row="1">
									<TextBlock x:Name="txtPanoLoading" Text="Loading..." Style="{StaticResource PhoneTextExtraLargeStyle}" />
									<ContentPresenter Content="{TemplateBinding Content}" 
										HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}" 
										Margin="{TemplateBinding Padding}" 
										VerticalAlignment="{TemplateBinding VerticalContentAlignment}"/>
								</StackPanel>
							</Grid>
						</ScrollViewer>
					</ControlTemplate>
				</Setter.Value>
			</Setter>
		</Style>
		<Style x:Key="ListBoxStyle1" TargetType="ListBox">
			<Setter Property="Background" Value="Transparent"/>
			<Setter Property="Foreground" Value="{StaticResource PhoneForegroundBrush}"/>
			<Setter Property="ScrollViewer.HorizontalScrollBarVisibility" Value="Disabled"/>
			<Setter Property="ScrollViewer.VerticalScrollBarVisibility" Value="Auto"/>
			<Setter Property="BorderThickness" Value="0"/>
			<Setter Property="BorderBrush" Value="Transparent"/>
			<Setter Property="Padding" Value="0"/>
			<Setter Property="Template">
				<Setter.Value>
					<ControlTemplate TargetType="ListBox">
						<ScrollViewer x:Name="ScrollViewer" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" Background="{TemplateBinding Background}" Foreground="{TemplateBinding Foreground}" Padding="{TemplateBinding Padding}">
							<ItemsPresenter/>
						</ScrollViewer>
					</ControlTemplate>
				</Setter.Value>
			</Setter>
		</Style>
		<ItemsPanelTemplate x:Key="ItemsPanelTemplate3">
			<toolkit:WrapPanel Orientation="Horizontal" />
		</ItemsPanelTemplate>
		<DataTemplate x:Key="DataTemplate1">
			<Grid Margin="12">
				<Border Width="173" Height="173" x:Name="frontPanel" Canvas.ZIndex="1">
					<Grid>
						<Image Source="{Binding FrontImage}" />    		
						<TextBlock Text="{Binding FrontContent}" Margin="6,0,0,0" TextWrapping="Wrap" />
						<TextBlock Text="{Binding FrontTitle}" VerticalAlignment="Bottom" HorizontalAlignment="Left" Margin="6,0,0,0" />
					</Grid>
				</Border>
				<Border Width="173" Height="173" x:Name="backPanel">
					<Border.Projection>
						<PlaneProjection RotationX="180"/>
					</Border.Projection>
					<Grid>
						<Image Source="{Binding BackImage}" />    		
						<TextBlock Text="{Binding BackContent}" Margin="6,0,0,0" TextWrapping="Wrap" />
						<TextBlock Text="{Binding BackTitle}" VerticalAlignment="Bottom" HorizontalAlignment="Left" Margin="6,0,0,0" />
					</Grid>
				</Border>
        			
			</Grid>
		</DataTemplate>
		<Style x:Key="PanningBackgroundLayerStyle1" TargetType="controlsPrimitives:PanningBackgroundLayer">
			<Setter Property="Template">
				<Setter.Value>
					<ControlTemplate TargetType="controlsPrimitives:PanningBackgroundLayer">
						<StackPanel Orientation="Horizontal">
							<StackPanel.RenderTransform>
								<TransformGroup>
									<TranslateTransform x:Name="PanningTransform"/>
									<TranslateTransform x:Name="LocalTransform"/>
								</TransformGroup>
							</StackPanel.RenderTransform>
							<Rectangle x:Name="LeftWraparound" CacheMode="BitmapCache" Canvas.ZIndex="0"/>
							<ContentPresenter x:Name="ContentPresenter" CacheMode="BitmapCache" ContentTemplate="{TemplateBinding ContentTemplate}" Content="{TemplateBinding Content}" HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}" Margin="{TemplateBinding Padding}" VerticalAlignment="{TemplateBinding VerticalContentAlignment}" Canvas.ZIndex="1"/>
							<Rectangle x:Name="RightWraparound" CacheMode="BitmapCache" Canvas.ZIndex="0"/>
						</StackPanel>
					</ControlTemplate>
				</Setter.Value>
			</Setter>
		</Style>
		
		<Style x:Key="PanoramaStyle1" TargetType="controls:Panorama">
			<Setter Property="ItemsPanel">
				<Setter.Value>
					<ItemsPanelTemplate>
						<controlsPrimitives:PanoramaPanel x:Name="panel"/>
					</ItemsPanelTemplate>
				</Setter.Value>
			</Setter>
			<Setter Property="Foreground" Value="{StaticResource PhoneForegroundBrush}"/>
			<Setter Property="Background" Value="Transparent"/>
			<Setter Property="Template">
				<Setter.Value>
					<ControlTemplate TargetType="controls:Panorama">
						<Grid>
							<Grid.RowDefinitions>
								<RowDefinition Height="auto"/>
								<RowDefinition Height="*"/>
							</Grid.RowDefinitions>
							<controlsPrimitives:PanningBackgroundLayer x:Name="BackgroundLayer" HorizontalAlignment="Left" Grid.RowSpan="2" Style="{StaticResource PanningBackgroundLayerStyle1}">
								<Grid>
									<Border x:Name="background" 
									Background="{TemplateBinding Background}" 
									CacheMode="BitmapCache"/>
								</Grid>
							</controlsPrimitives:PanningBackgroundLayer>
							<controlsPrimitives:PanningTitleLayer x:Name="TitleLayer" CacheMode="BitmapCache" ContentTemplate="{TemplateBinding TitleTemplate}" Content="{TemplateBinding Title}" FontSize="187" FontFamily="{StaticResource PhoneFontFamilyLight}" HorizontalAlignment="Left" Margin="10,-76,0,9" Grid.Row="0"/>
							<Canvas Grid.RowSpan="2" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Opacity="0.6" Background="Black" Margin="0" />
							<controlsPrimitives:PanningLayer x:Name="ItemsLayer" HorizontalAlignment="Left" Grid.Row="1">
								<ItemsPresenter x:Name="items"/>
							</controlsPrimitives:PanningLayer>
						</Grid>
					</ControlTemplate>
				</Setter.Value>
			</Setter>
		</Style>
		<DataTemplate x:Key="DataTemplate2">
			<Grid Margin="0,79,0,0">
				<Image Source="/Images/tweeta-pano.png" Margin="0,0,0,24" />
			</Grid>
		</DataTemplate>
		
	</phone:PhoneApplicationPage.Resources>

	<phone:PhoneApplicationPage.FontFamily>
		<StaticResource ResourceKey="PhoneFontFamilyNormal"/>
	</phone:PhoneApplicationPage.FontFamily>
	<phone:PhoneApplicationPage.FontSize>
		<StaticResource ResourceKey="PhoneFontSizeNormal"/>
	</phone:PhoneApplicationPage.FontSize>
	<phone:PhoneApplicationPage.Foreground>
		<StaticResource ResourceKey="PhoneForegroundBrush"/>
	</phone:PhoneApplicationPage.Foreground>
	
	
	
<!--Panorama-based applications should not show an ApplicationBar-->
<phone:PhoneApplicationPage.ApplicationBar>
    <shell:ApplicationBar IsVisible="True" IsMenuEnabled="True" Mode="Minimized" Opacity="1.0" >
        
        <shell:ApplicationBar.MenuItems>
        	<shell:ApplicationBarMenuItem Text="settings"  />
            
        </shell:ApplicationBar.MenuItems>

        <shell:ApplicationBarIconButton IconUri="/Images/appbar.add.rest.png" Text="new tweet" />
        <shell:ApplicationBarIconButton IconUri="/icons/appbar.feature.search.rest.png" Text="search" />

    </shell:ApplicationBar>
</phone:PhoneApplicationPage.ApplicationBar>

    <Grid x:Name="LayoutRoot">
    	<controls:Panorama x:Name="panorama" 
		
    		Title="{Binding AppResources.ApplicationNameLower, Mode=OneWay}" 
    		Style="{StaticResource PanoramaStyle1}" 
    		Background="{Binding BackgroundUrl}" TitleTemplate="{StaticResource DataTemplate2}" Foreground="#DEFFFFFF">
    		<controls:Panorama.DataContext>
    			<Tweeta_ViewModel_Pages:PanoramaPageViewModel/>
    		</controls:Panorama.DataContext>
    		
    		<controls:PanoramaItem x:Name="panoMe" Header="{Binding UserVM.Username}" >
    			<controls:PanoramaItem.DataContext>
    				<Tweeta_ViewModel:PanoramaMeViewModel/>
    			</controls:PanoramaItem.DataContext>
    			<Grid>
				
    				<Tweeta:PanoramaMeControl d:LayoutOverrides="Width, Height" DataContext="{Binding DataContext, ElementName=panoMe}"/>
				
    			</Grid>
    		</controls:PanoramaItem>
				
    		<customControls:LoadingPanoramaItem x:Name="panoTimeline" 
    			Style="{StaticResource PanoramaLoadingStyle}" 
    			LoadingVisibility="{Binding IsLoading, Converter={StaticResource BoolToVisibilityConverter}, Mode=TwoWay}" 
    			Header="{Binding AppResources.PanoramaTimeline, Mode=OneWay}">
    			<customControls:LoadingPanoramaItem.DataContext>
    				<Tweeta_ViewModel:PanoramaTimelineViewModel/>
    			</customControls:LoadingPanoramaItem.DataContext> 
    			<Grid>
    				<ItemsControl x:Name="lstTweets" 
    					ItemTemplate="{StaticResource TimelineRowTemplate}" ItemsSource="{Binding Items}" Margin="12,0,0,0"/>
    			</Grid>
    		</customControls:LoadingPanoramaItem>
    		<customControls:LoadingPanoramaItem x:Name="panoTrending" LoadingVisibility="{Binding IsLoading, Converter={StaticResource BoolToVisibilityConverter}, Mode=TwoWay}" Style="{StaticResource PanoramaLoadingStyle}" Header="{Binding AppResources.PanoramaTrending, Mode=OneWay}">
    			<customControls:LoadingPanoramaItem.DataContext>
    				<Tweeta_ViewModel:PanoramaTrendingViewModel />
    			</customControls:LoadingPanoramaItem.DataContext>
    			<Grid>
    				<ItemsControl ItemTemplate="{StaticResource TrendingItemTemplate}" ItemsSource="{Binding TrendingItems}" Margin="12,0,0,0"/>
    			</Grid>
    		</customControls:LoadingPanoramaItem>
    		<customControls:LoadingPanoramaItem x:Name="panoSearch" Header="{Binding AppResources.PanoramaSearch, Mode=OneWay}" Style="{StaticResource PanoramaLoadingStyle}" LoadingVisibility="{Binding IsLoading, Converter={StaticResource BoolToVisibilityConverter}, Mode=TwoWay}">
    			<customControls:LoadingPanoramaItem.DataContext>
    				<Tweeta_ViewModel:PanoramaSearchViewModel/>
    			</customControls:LoadingPanoramaItem.DataContext>
    			<Grid>
    				<ItemsControl ItemTemplate="{StaticResource TimelineRowTemplate}" ItemsSource="{Binding Items}" Margin="12,0,0,0"/>
    			</Grid>
    		</customControls:LoadingPanoramaItem>
			
			
    	</controls:Panorama>
    </Grid>
	
	
	
</phone:PhoneApplicationPage>